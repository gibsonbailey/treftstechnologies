"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var TTplot=function a(b,c,d){var e=this;_classCallCheck(this,a),_defineProperty(this,"set_array",function(a,b){e.array=a,e.array_opts=b,e.plot_array()}),_defineProperty(this,"plot_array",function(){e.context.strokeStyle=e.array_opts.color,e.context.lineWidth=e.array_opts.line_width,e.context.beginPath();for(var a,b=0;b<e.array.length;b++)a=e.grid_to_canvas_space(e.array[b].x,e.array[b].y),0==b?e.context.moveTo(a.x,a.y):e.context.lineTo(a.x,a.y);e.context.stroke()}),_defineProperty(this,"set_func",function(a,b){e.func=a,e.func_opts=b,e.plot_func()}),_defineProperty(this,"plot_func",function(){e.context.strokeStyle=e.func_opts.color,e.context.lineWidth=e.func_opts.line_width,e.context.beginPath();var a=e.canvas_to_grid_space(0,0),b=e.grid_to_canvas_space(a.x,e.func(a.x));e.context.moveTo(b.x,b.y);for(var f=0;f<e.width;f+=e.func_opts.res){var c=e.canvas_to_grid_space(f,0),d=e.grid_to_canvas_space(c.x,e.func(c.x));e.context.lineTo(d.x,d.y)}e.context.stroke()}),_defineProperty(this,"canvas_to_grid_space",function(a,b){return b=(b-(e.height-e.axes_config.origin.y))/e.tic_spacing,a=(a-e.axes_config.origin.x)/e.tic_spacing,{x:a,y:b}}),_defineProperty(this,"grid_to_canvas_space",function(a,b){return b=e.height-e.axes_config.origin.y-b*e.tic_spacing,a=e.axes_config.origin.x+a*e.tic_spacing,{x:a,y:b}}),_defineProperty(this,"clear",function(){e.context.clearRect(0,0,e.width,e.height)}),_defineProperty(this,"resize_canvas_to_display_size",function(){var a=e.canvas.clientWidth,b=e.canvas.clientHeight;e.dpr=window.devicePixelRatio||1,e.canvas.width=a*e.dpr,e.canvas.height=b*e.dpr,e.width=a,e.height=b,e.context.scale(e.dpr,e.dpr)}),_defineProperty(this,"draw_background",function(){e.context.fillStyle=e.background_color,e.context.fillRect(0,0,e.width,e.height)}),_defineProperty(this,"axes",function(a){e.axes_config=a,e.draw_2d_axes()}),_defineProperty(this,"set_arrows",function(a){e.arrows=a,e.draw_arrows()}),_defineProperty(this,"draw_2d_axes",function(){var a=e.axes_config.origin.x,b=e.axes_config.origin.y,c=e.axes_config.line_width,d=e.axes_config.color;e.context.fillStyle="white",e.context.font=10*c+"px MathJax_Math",b=e.height-b,e.context.lineWidth=c,e.context.strokeStyle=d,e.context.beginPath(),e.context.moveTo(0,b),e.context.lineTo(e.width,b),e.context.stroke(),e.context.moveTo(a,0),e.context.lineTo(a,e.height),e.context.stroke(),e.context.lineWidth=c/2,e.context.beginPath();for(var f=Math.min(e.height,e.width)/60,g=1,h=a+e.tic_spacing,i=b;h<=e.width;)e.axes_config.grid?(e.context.moveTo(h+.5,0),e.context.lineTo(h+.5,e.height)):(e.context.moveTo(h+.5,i-f),e.context.lineTo(h+.5,i+f)),e.context.stroke(),e.x_labels&&e.context.fillText(g,h+.5,i+2*f),h+=e.tic_spacing,g+=1;for(g=-1,h=a-e.tic_spacing;0<=h;)e.axes_config.grid?(e.context.moveTo(h+.5,0),e.context.lineTo(h+.5,e.height)):(e.context.moveTo(h+.5,i-f),e.context.lineTo(h+.5,i+f)),e.context.stroke(),e.x_labels&&e.context.fillText(g,h+.5,i+2*f),h-=e.tic_spacing,g-=1;var j=-1;for(h=a,i=b+e.tic_spacing;i<=e.height;)e.axes_config.grid?(e.context.moveTo(0,i+.5),e.context.lineTo(e.width,i+.5)):(e.context.moveTo(h-f,i+.5),e.context.lineTo(h+f,i+.5)),e.context.stroke(),e.y_labels&&e.context.fillText(j,h+f,i+.5),i+=e.tic_spacing,j-=1;for(j=1,i=b-e.tic_spacing;0<=i;)e.axes_config.grid?(e.context.moveTo(0,i+.5),e.context.lineTo(e.width,i+.5)):(e.context.moveTo(h-f,i+.5),e.context.lineTo(h+f,i+.5)),e.context.stroke(),e.y_labels&&e.context.fillText(j,h+f,i+.5),i-=e.tic_spacing,j+=1}),_defineProperty(this,"draw_arrows",function(){for(var a=0;a<e.arrows.length;a++)e.draw_arrow(e.arrows[a].start_point.x,e.arrows[a].start_point.y,e.arrows[a].delta.x,e.arrows[a].delta.y,e.arrows[a].line_width,e.arrows[a].color,e.arrows[a].label)}),_defineProperty(this,"draw_arrow",function(a,b,c,d,f,g,h){var i=Math.PI,j=Math.sin,k=Math.cos;a=e.axes_config.origin.x+a*e.tic_spacing,b=e.axes_config.origin.y-b*e.tic_spacing,c*=e.tic_spacing,d*=e.tic_spacing,b=e.height-b;var l=a+c,m=b-d;e.context.strokeStyle=g,e.context.fillStyle=g,e.context.lineWidth=f;var n=1.8*f,o=Math.atan2(-d,c),p=n*k(o)+l,q=n*j(o)+m;o+=1/3*(2*i);var r=n*k(o)+l,s=n*j(o)+m;o+=1/3*(2*i);var t=n*k(o)+l,u=n*j(o)+m;if(e.context.beginPath(),e.context.moveTo(a,b),e.context.lineTo(.5*(r+t),.5*(s+u)),e.context.stroke(),e.context.moveTo(p,q),e.context.lineTo(r,s),e.context.lineTo(t,u),e.context.closePath(),e.context.fill(),!!h){var v=a+1.2*c,w=b-1.2*d;e.context.fillStyle=h.color,e.context.font=10*f+"px MathJax_Math",e.context.fillText(h.text,v,w)}}),_defineProperty(this,"set_extra_draw_func",function(a){e.extra_draw_func=a}),this.context=b.getContext("2d"),this.canvas=b,this.resize_canvas_to_display_size(),this.background_color=d,this.draw_background();var f=this;this.x_labels=!1,this.y_labels=!1,this.canvas.addEventListener("mousemove",function(a){var b=a.offsetX,c=f.height-a.offsetY;if(!!f.axes_config){f.y_labels=!!(b>=f.axes_config.origin.x-4*f.axes_config.line_width&&b<=f.axes_config.origin.x+4*f.axes_config.line_width),f.x_labels=!!(c>=f.axes_config.origin.y-4*f.axes_config.line_width&&c<=f.axes_config.origin.y+4*f.axes_config.line_width),f.clear(),f.draw_background(),f.draw_2d_axes(),!f.arrows||f.draw_arrows(),!f.array||f.plot_array(),!f.func||f.plot_func(),!f.extra_draw_func||f.extra_draw_func(f,b,a.offsetY)}}),this.tic_spacing=c};